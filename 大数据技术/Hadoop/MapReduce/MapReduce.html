<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>基本原理</title>
    <link rel="stylesheet" href="../../../style.css" />
</head>
<body>
<h2 id="_1">基本原理</h2>
<h3 id="_2">初始化</h3>
<ul>
<li>每个任务被初始化成一个<strong><em>Job</em></strong>，每个Job分为两个阶段：Map阶段和Reduce阶段</li>
</ul>
<h3 id="_3">输入</h3>
<ul>
<li><code>InputSplit</code><ul>
<li>represents the data to be processed by an individual Mapper</li>
<li>byte-oriented view</li>
</ul>
</li>
<li><code>RecordReader</code><ul>
<li>reads &lt;key, value&gt; pairs from an InputSplit</li>
</ul>
</li>
</ul>
<h3 id="map">Map</h3>
<ul>
<li><strong><em>Map阶段</em></strong>接收&lt;key,value>形式的输入，产生&lt;key,value>形式的输出</li>
</ul>
<h3 id="reduce">Reduce</h3>
<ul>
<li><strong><em>Reduce阶段</em></strong>接收&lt;key, (list of values)>形式的输入，产生&lt;key,value>形式的输出</li>
<li><strong><em>shuffle过程</em></strong>：把相同的key值放在一起</li>
</ul>
<h3 id="_4">输出</h3>
<p><img alt="" src="/images/MapReduce.png" /></p>
<h2 id="_5">组件</h2>
<ul>
<li><strong><em>JobTracker</em></strong>用于管理和调度工作；一个Hadoop集群只有一个JobTracker</li>
<li><strong><em>TaskTracker</em></strong>用于执行工作</li>
</ul>
<p><img alt="" src="/images/MapReduce_v1.png" /></p>
<h2 id="_6">命令</h2>
<h5 id="_7">编译</h5>
<div class="codehilite" style="background: #202020"><pre style="line-height: 125%"><span style="color: #40ffff">JARS</span><span style="color: #d0d0d0">=</span><span style="color: #6ab825; font-weight: bold">$(</span>addprefix /home/hadoop/hadoop-1.2.1/,hadoop-core-1.2.1.jar lib/commons-cli-1.2.jar<span style="color: #6ab825; font-weight: bold">)</span>
<span style="color: #447fcf">all</span><span style="color: #d0d0d0">:</span>
    mkdir -p build
    javac -classpath <span style="color: #6ab825; font-weight: bold">$(</span>shell <span style="color: #24909d">echo</span> <span style="color: #6ab825; font-weight: bold">$(</span>JARS<span style="color: #6ab825; font-weight: bold">)</span> | sed <span style="color: #ed9d13">&quot;s/ /:/&quot;</span><span style="color: #6ab825; font-weight: bold">)</span> <span style="color: #ed9d13">\</span>
        -d build WordCount.java
    jar -cvf wordcount.jar -C build/ .
</pre></div>


<p>或</p>
<div class="codehilite" style="background: #202020"><pre style="line-height: 125%">mkdir build
javac -cp <span style="color: #6ab825; font-weight: bold">$(</span>hadoop classpath<span style="color: #6ab825; font-weight: bold">)</span> -d build <span style="color: #6ab825; font-weight: bold">$(</span>find -name *.java<span style="color: #6ab825; font-weight: bold">)</span>
jar -cvf job.jar -C build/ .
</pre></div>


<h5 id="_8">运行</h5>
<div class="codehilite" style="background: #202020"><pre style="line-height: 125%"><span style="color: #999999; font-style: italic">#hadoop jar wordcount.jar org.apache.hadoop.examples.WordCount input output</span>
hadoop jar <span style="color: #40ffff">$JarFile</span> <span style="color: #40ffff">$FullClassName</span> <span style="color: #40ffff">$InputDir</span> <span style="color: #40ffff">$OutputDir</span>

<span style="color: #999999; font-style: italic">#运行Hadoop流</span>
<span style="color: #999999; font-style: italic">#hadoop jar contrib/streaming/hadoop-streaming-1.2.1.jar -input input -output output -mapper /bin/cat -reducer /usr/bin/wc</span>
hadoop jar <span style="color: #40ffff">$HadoopStreamJar</span> -input <span style="color: #40ffff">$InputDir</span> -output <span style="color: #40ffff">$OutputDir</span> -mapper <span style="color: #40ffff">$MapperBin</span> -reducer <span style="color: #40ffff">$ReducerBin</span>
</pre></div>


<h5 id="_9">状态</h5>
<div class="codehilite" style="background: #202020"><pre style="line-height: 125%"><span style="color: #999999; font-style: italic">#显示作业列表</span>
hadoop job -list
</pre></div>


<h5 id="_10">管理</h5>
<div class="codehilite" style="background: #202020"><pre style="line-height: 125%"><span style="color: #999999; font-style: italic">#终止作业</span>
hadoop job -kill <span style="color: #40ffff">$JobId</span>
</pre></div>


<h2 id="eclipse">eclipse</h2>
<ul>
<li>Project &gt; Properties &gt; Java Build Path &gt; Libraries &gt; Add External Jars添加hadoop的jar</li>
</ul>
<h2 id="_11">参考</h2>
<ul>
<li><a href="http://hadoop.apache.org/docs/r2.7.1/hadoop-mapreduce-client/hadoop-mapreduce-client-core/MapReduceTutorial.html">MapReduce Tutorial</a></li>
<li><a href="http://www.lichun.cc/blog/2012/05/hadoop-multipleinputs-usage/">Hadoop MultipleInputs sample usage</a></li>
<li><a href="http://www.cloudera.com/content/cloudera/en/documentation/core/latest/topics/cdh_ig_table_access_mapreduce.html">Accessing Table Data with MapReduce</a></li>
</ul>
</body>
</html>
