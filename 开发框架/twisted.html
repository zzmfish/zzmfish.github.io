<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Twisted</title>
    <link rel="stylesheet" href="../style.css" />
</head>
<body>
<h1 id="twisted">Twisted</h1>
<ul>
<li>异步模型中，一个任务要想运行必须显式放弃当前运行的任务的控制权  </li>
<li>当一个任务出现阻塞时，会让其它可以执行的任务继续执行</li>
<li></li>
<li>
<p><a href="http://blog.sina.com.cn/s/blog_704b6af70100py9n.html">我看到的最棒的Twisted入门教程！</a></p>
</li>
<li><a href="http://www.oschina.net/translate/stress-testing-http-with-twisted-python-and-treq">使用 Twisted Python 和 Treq 进行 HTTP 压力测试</a></li>
</ul>
<h2 id="deferred">Deferred</h2>
<ul>
<li>manage the callback sequence</li>
<li>be called in order when the results are available</li>
</ul>
<p><img alt="" src="/images/Twisted_Deferred.png" /></p>
<p><img src="data:image/png;base64,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" /></p>
<h2 id="_1">示例代码</h2>
<h6 id="_2">请求网页</h6>
<div class="codehilite" style="background: #202020"><pre style="line-height: 125%"><span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">twisted.internet</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">reactor</span>
<span style="color: #6ab825; font-weight: bold">from</span> <span style="color: #447fcf; text-decoration: underline">twisted.web.client</span> <span style="color: #6ab825; font-weight: bold">import</span> <span style="color: #d0d0d0">Agent</span>

<span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">handle_response</span><span style="color: #d0d0d0">(response):</span>
    <span style="color: #6ab825; font-weight: bold">print</span> <span style="color: #d0d0d0">response</span>
<span style="color: #d0d0d0">agent</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">Agent(reactor)</span>
<span style="color: #d0d0d0">agent.request(</span><span style="color: #ed9d13">&#39;GET&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #ed9d13">&#39;http://www.baidu.com&#39;</span><span style="color: #d0d0d0">)</span> \
    <span style="color: #d0d0d0">.addBoth(handle_response)</span>
<span style="color: #d0d0d0">reactor.run()</span>
</pre></div>


<h6 id="ctrlc">Ctrl+C退出</h6>
<div class="codehilite" style="background: #202020"><pre style="line-height: 125%"><span style="color: #6ab825; font-weight: bold">def</span> <span style="color: #447fcf">interrupt_handler</span><span style="color: #d0d0d0">(signum,</span> <span style="color: #d0d0d0">frame):</span>
    <span style="color: #d0d0d0">reactor.callFromThread(reactor.stop)</span>

<span style="color: #d0d0d0">signal.signal(signal.SIGINT,</span> <span style="color: #d0d0d0">interrupt_handler)</span>
</pre></div>


<h2 id="_3">参考</h2>
<ul>
<li><a href="https://twistedmatrix.com/documents/14.0.1/web/howto/client.html">Using the Twisted Web Client</a></li>
<li><a href="https://twistedmatrix.com/documents/14.0.1/web/howto/client.html">Using Threads in Twisted</a></li>
<li><a href="https://twistedmatrix.com/documents/14.0.1/core/howto/defer.html">Deferred Reference</a></li>
</ul>
</body>
</html>
