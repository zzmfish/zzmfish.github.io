<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>内存管理</title>
    <link rel="stylesheet" href="/style.css" />
</head>
<body>
<h2 id="_1">内存管理</h2>
<h3 id="_2">堆内存</h3>
<h3 id="_3">非堆内存</h3>
<h3 id="_4">参数</h3>
<ul>
<li>-Xms128m JVM初始分配的堆内存</li>
<li>-Xmx512m JVM最大允许分配的堆内存，按需分配</li>
<li>-XX:PermSize=64M JVM初始分配的非堆内存</li>
<li>-XX:MaxPermSize=128M JVM最大允许分配的非堆内存，按需分配</li>
</ul>
<h2 id="_5">数据类型</h2>
<h3 id="_6">容器</h3>
<h5 id="linkedlist">LinkedList</h5>
<h5 id="arraylist">ArrayList</h5>
<h5 id="hashset">HashSet</h5>
<div class="codehilite" style="background: #202020"><pre style="line-height: 125%"><span style="color: #999999; font-style: italic">//从数组构建</span>
<span style="color: #d0d0d0">HashSet</span> <span style="color: #d0d0d0">set</span> <span style="color: #d0d0d0">=</span> <span style="color: #6ab825; font-weight: bold">new</span> <span style="color: #d0d0d0">HashSet&lt;String&gt;(Arrays.</span><span style="color: #bbbbbb">asList</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot;a&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #ed9d13">&quot;b&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #ed9d13">&quot; c&quot;</span><span style="color: #d0d0d0">));</span>
</pre></div>


<h3 id="_7">类</h3>
<h4 id="_8">内部类</h4>
<ul>
<li>静态内部类：不保留父类和子类的引用关系</li>
<li>非静态内部类：保留父类和子类的引用关系</li>
</ul>
<h2 id="_9">技巧</h2>
<div class="codehilite" style="background: #202020"><pre style="line-height: 125%"><span style="color: #999999; font-style: italic">//backtrace</span>
<span style="color: #6ab825; font-weight: bold">for</span> <span style="color: #d0d0d0">(StackTraceElement</span> <span style="color: #d0d0d0">ste</span> <span style="color: #d0d0d0">:</span> <span style="color: #d0d0d0">Thread.</span><span style="color: #bbbbbb">currentThread</span><span style="color: #d0d0d0">().</span><span style="color: #bbbbbb">getStackTrace</span><span style="color: #d0d0d0">())</span> <span style="color: #d0d0d0">{</span>
    <span style="color: #d0d0d0">System.</span><span style="color: #bbbbbb">out</span><span style="color: #d0d0d0">.</span><span style="color: #bbbbbb">println</span><span style="color: #d0d0d0">(ste);</span>
<span style="color: #d0d0d0">}</span>

<span style="color: #999999; font-style: italic">//读取文件</span>
<span style="color: #d0d0d0">FileInputStream</span> <span style="color: #d0d0d0">fileInputStream</span> <span style="color: #d0d0d0">=</span> <span style="color: #6ab825; font-weight: bold">new</span> <span style="color: #d0d0d0">FileInputStream(</span><span style="color: #6ab825; font-weight: bold">new</span> <span style="color: #d0d0d0">File(</span><span style="color: #ed9d13">&quot;conf/hbase-site.xml&quot;</span><span style="color: #d0d0d0">));</span>

<span style="color: #999999; font-style: italic">//保存文件</span>
<span style="color: #d0d0d0">FileInputStream</span> <span style="color: #d0d0d0">fileInputStream</span> <span style="color: #d0d0d0">=</span> <span style="color: #6ab825; font-weight: bold">new</span> <span style="color: #d0d0d0">FileInputStream(</span><span style="color: #6ab825; font-weight: bold">new</span> <span style="color: #d0d0d0">File(</span><span style="color: #ed9d13">&quot;conf/hbase-site.xml&quot;</span><span style="color: #d0d0d0">));</span>
</pre></div>


<h2 id="_10">编译</h2>
<div class="codehilite" style="background: #202020"><pre style="line-height: 125%">javac <span style="color: #24909d">test</span>/tools/DBTool.java
javac -cp .:lib/test.jar tools/DBTool.java
</pre></div>


<h2 id="_11">运行</h2>
<div class="codehilite" style="background: #202020"><pre style="line-height: 125%">java -cp .:lib/test.jar tools.DBTool
</pre></div>


<h2 id="_12">状态</h2>
<div class="codehilite" style="background: #202020"><pre style="line-height: 125%"><span style="color: #999999; font-style: italic">#列举java进程</span>
jps

<span style="color: #999999; font-style: italic">#显示进程的内存状况</span>
jmap -heap <span style="color: #40ffff">$Pid</span>

<span style="color: #999999; font-style: italic">##显示线程堆栈</span>
jstack <span style="color: #40ffff">$Pid</span>
</pre></div>


<h2 id="_13">参考</h2>
<ul>
<li><a href="http://www.slideshare.net/mraible/comparing-jvm-web-frameworks-february-2014">Comparing JVM Web Frameworks (2014-2)</a></li>
<li><a href="https://wiki.apache.org/hadoop/Hbase/Shell">Java Heap space - HotSpot VM</a></li>
<li><a href="http://w.gdu.me/wiki/Java/JVM_Heap_Non-heap.html">JVM堆内存和非堆内存</a></li>
<li><a href="http://javaeesupportpatterns.blogspot.de/2012/09/outofmemoryerror-unable-to-create-new.html">OutOfMemoryError: unable to create new native thread</a></li>
<li><a href="http://www.importnew.com/1153.html">
嵌套类：静态嵌套类和非静态嵌套类</a></li>
</ul>
</body>
</html>
