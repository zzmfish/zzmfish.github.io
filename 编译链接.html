<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>编译链接经验技巧</title>
    <link rel="stylesheet" href="style.css" />
</head>
<body>
<h1 id="_1">编译链接经验技巧</h1>
<h2 id="gcc">gcc选项</h2>
<p><strong><em>-fsanitize=address</em></strong>：检测内存错误<br />
<strong><em>-finstrument-functions</em></strong>：函数跟踪<br />
<strong><em>-ffunction-sections</em></strong>：将不同函数编译到不同的section<br />
<strong><em>-fdata-sections</em></strong>：将不同数据编译到不同的section<br />
<strong><em>--gc-sections</em></strong>：去掉不用的函数section<br />
<strong><em>-pipe</em></strong>：通过管道传递中间结果 <br />
<strong><em>-E</em></strong>: 预处理后停止<br />
<strong><em>-MM</em></strong>：生成.d依赖文件<br />
<strong><em>-std</em></strong>：c++98/c++03/c++11/gnu++98/gnu++03/gnu++11  </p>
<h2 id="_2">静态库</h2>
<div class="codehilite" style="background: #202020"><pre style="line-height: 125%"><span style="color: #999999; font-style: italic">#创建静态库</span>
ar rcs libfoo.a foo.o

<span style="color: #999999; font-style: italic">#解压静态库</span>
ar x libfoo.a
</pre></div>


<h2 id="_3">动态库</h2>
<div class="codehilite" style="background: #202020"><pre style="line-height: 125%"><span style="color: #999999; font-style: italic">#创建动态库</span>
gcc -o foo.o -fPIC foo.c
gcc -shared -o libfoo.so foo.o

<span style="color: #999999; font-style: italic">#显示依赖的动态库</span>
ldd libfoo.so
</pre></div>


<ul>
<li>PIC</li>
<li>弱符号</li>
</ul>
<h2 id="_4">符号信息</h2>
<div class="codehilite" style="background: #202020"><pre style="line-height: 125%"><span style="color: #999999; font-style: italic">#查看符号表</span>
objdump -t libfoo.so

<span style="color: #999999; font-style: italic">#显示符号</span>
nm libfoo.so
</pre></div>


<h2 id="makefile">Makefile</h2>
<p>编译规则</p>
<div class="codehilite" style="background: #202020"><pre style="line-height: 125%"><span style="color: #447fcf">%.o </span><span style="color: #d0d0d0">:</span> <span style="color: #3677a9">%.c</span>
    <span style="color: #6ab825; font-weight: bold">$(</span>CC<span style="color: #6ab825; font-weight: bold">)</span> -c <span style="color: #6ab825; font-weight: bold">$(</span>CFLAGS<span style="color: #6ab825; font-weight: bold">)</span> <span style="color: #6ab825; font-weight: bold">$(</span>CPPFLAGS<span style="color: #6ab825; font-weight: bold">)</span> <span style="color: #40ffff">$&lt;</span> -o <span style="color: #40ffff">$@</span>
</pre></div>


<p>其中<code>%</code>表示文件名，<code>$&lt;</code>表示依赖目标，<code>$@</code>表示目标</p>
<p>后缀替换：<code>OBJS=$(SRCS:.cpp=.o)</code></p>
<h2 id="cmake">CMake</h2>
<p>项目编译和安装：</p>
<div class="codehilite" style="background: #202020"><pre style="line-height: 125%">cmake -DCMAKE_INSTALL_PREFIX:PATH<span style="color: #d0d0d0">=</span><span style="color: #40ffff">$HOME</span>/local 
make
make install  
</pre></div>
</body>
</html>

