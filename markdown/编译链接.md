# 编译链接经验技巧

## gcc选项
***-fsanitize=address***：检测内存错误  
***-finstrument-functions***：函数跟踪  
***-ffunction-sections***：将不同函数编译到不同的section  
***-fdata-sections***：将不同数据编译到不同的section  
***--gc-sections***：去掉不用的函数section  
***-pipe***：通过管道传递中间结果   
***-E***: 预处理后停止  
***-MM***：生成.d依赖文件  
***-std***：c++98/c++03/c++11/gnu++98/gnu++03/gnu++11  


## 静态库
```
#!bash
#创建静态库
ar rcs libfoo.a foo.o

#解压静态库
ar x libfoo.a
```

## 动态库
```
#!bash
#创建动态库
gcc -o foo.o -fPIC foo.c
gcc -shared -o libfoo.so foo.o

#显示依赖的动态库
ldd libfoo.so
```
* PIC
* 弱符号

## 符号信息
```
#!bash
#查看符号表
objdump -t libfoo.so

#显示符号
nm libfoo.so
```

## Makefile
编译规则
```
#!makefile
%.o : %.c
    $(CC) -c $(CFLAGS) $(CPPFLAGS) $< -o $@
```
其中`%`表示文件名，`$<`表示依赖目标，`$@`表示目标

后缀替换：`OBJS=$(SRCS:.cpp=.o)`

## CMake
项目编译和安装：
```
#!bash
cmake -DCMAKE_INSTALL_PREFIX:PATH=$HOME/local 
make
make install  
```